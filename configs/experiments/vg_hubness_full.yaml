# Visual Genome + Hubness + 完整防御实验配置
name: "vg_hubness_full_experiment"
description: "Complete experiment: Visual Genome dataset + Hubness attack + full defense (TVC + GenRef)"
version: "1.0"

# 继承基础配置
inherits:
  - "../default.yaml"
  - "../datasets/visual_genome.yaml"
  - "../attacks/hubness.yaml"
  - "../defenses/base.yaml"

# 实验特定覆盖配置
overrides:
  # 数据集配置覆盖
  dataset:
    loading:
      # batch_size继承自hubness.yaml中的配置 (32)
      # VG复杂注释，batch_size已在hubness.yaml中合理配置
      pass
    splits:
      test:
        size: 1500  # 使用适中子集进行实验
      
  # 攻击配置覆盖
  attack:
    parameters:
      num_iterations: 100  # 适中的迭代次数
      k_neighbors: 30      # 适合VG复杂场景的k近邻数量
      epsilon: 0.031       # 8/255
      learning_rate: 0.02
      num_target_queries: 100  # 适合VG的目标查询数量
      gamma: 0.9
      gamma_epochs: 10
      hubness_threshold: 0.6
      
  # 防御配置覆盖
  defense:
    text_variants:
      enabled: true
      num_variants: 5
      strategies: ["synonym", "paraphrase", "reorder"]
    generative_reference:
      enabled: true
      num_references: 3
    detector:
      weights:
        direct_consistency: 0.25
        text_variant_consistency: 0.35
        generative_reference_consistency: 0.4

# 实验流程配置
workflow:
  stages:
    - "data_preparation"
    - "attack_generation"
    - "defense_evaluation"
    - "metrics_calculation"
    - "visualization"

# 评估指标
metrics:
  - "attack_success_rate"
  - "defense_success_rate"
  - "top_k_retrieval_accuracy"
  - "detection_rate"
  - "false_positive_rate"
  - "computational_overhead"

# 输出配置
output:
  save_adversarial_samples: true
  save_detection_results: true
  save_metrics: true
  generate_visualizations: true
  results_dir: "results/vg_hubness_full"